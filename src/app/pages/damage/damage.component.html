<section class="bg-white dark:bg-white-100 shadow-md sm:rounded-lg p-4 sm:p-6 mx-2 sm:mx-auto max-w-7xl mt-20">
  
  <!-- Header -->
  <div class="flex items-center justify-between mb-6 border-b border-gray-200 pb-3">
    <h1 class="text-3xl font-medium text-gray-900 dark:text-gray-600">ðŸ’” Damage Records</h1>
  </div>

  <!-- Record Damage Form -->
  <div class="bg-white dark:bg-white-100 shadow-sm sm:rounded-lg p-6 mb-6">
    <h2 class="text-xl font-semibold text-gray-900 dark:text-gray-600 mb-4">Record New Damage</h2>
    
    <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
      
      <!-- Product Selection -->
      <div>
        <label class="block text-sm font-medium text-gray-700 dark:text-gray-500 mb-2">Select Product</label>
        <select 
          [(ngModel)]="selectedProductId" 
          (change)="onProductChange()"
          class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-yellow-500 focus:border-yellow-500 dark:bg-gray-50 dark:border-gray-400">
          <option [ngValue]="null">-- Select Product --</option>
          <option *ngFor="let p of products" [ngValue]="p.id">
            {{ p.category }} - {{ p.brand }} {{ p.model }} (Stock: {{ p.quantity }})
          </option>
        </select>
      </div>

      <!-- Quantity -->
      <div>
        <label class="block text-sm font-medium text-gray-700 dark:text-gray-500 mb-2">Quantity Damaged</label>
        <input 
          type="number" 
          [(ngModel)]="quantity" 
          min="1"
          [max]="selectedProduct?.quantity || 1"
          class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-yellow-500 focus:border-yellow-500 dark:bg-gray-50 dark:border-gray-400">
      </div>

      <!-- Damage Type -->
      <div>
        <label class="block text-sm font-medium text-gray-700 dark:text-gray-500 mb-2">Damage Type</label>
        <select 
          [(ngModel)]="damageType"
          class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-yellow-500 focus:border-yellow-500 dark:bg-gray-50 dark:border-gray-400">
          <option value="Broken Screen">Broken Screen</option>
          <option value="Water Damage">Water Damage</option>
          <option value="Defective">Defective</option>
          <option value="Physical Damage">Physical Damage</option>
          <option value="Other">Other</option>
        </select>
      </div>

      <!-- Buy Price (Auto) -->
      <div>
        <label class="block text-sm font-medium text-gray-700 dark:text-gray-500 mb-2">Buy Price (per unit)</label>
        <input 
          type="text" 
          [value]="selectedProduct ? 'Rs. ' + (selectedProduct.buyPrice | number) : 'Rs. 0'"
          disabled
          class="w-full px-4 py-2 border border-gray-300 rounded-lg bg-gray-100 dark:bg-gray-200">
      </div>

      <!-- Description -->
      <div class="md:col-span-2">
        <label class="block text-sm font-medium text-gray-700 dark:text-gray-500 mb-2">Description</label>
        <textarea 
          [(ngModel)]="description" 
          rows="3"
          placeholder="Describe the damage..."
          class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-yellow-500 focus:border-yellow-500 dark:bg-gray-50 dark:border-gray-400"></textarea>
      </div>

      <!-- Loss Amount (Calculated) -->
      <div class="md:col-span-2">
        <div class="bg-red-50 border border-red-500 rounded-lg p-4">
          <div class="text-sm text-gray-700">Total Loss Amount</div>
          <div class="text-2xl font-bold text-red-600">
            Rs. {{ calculateLoss() | number }}
          </div>
        </div>
      </div>
    </div>

    <!-- Submit Button -->
    <div class="mt-6 flex gap-3">
      <button 
        (click)="submitDamage()"
        [disabled]="!selectedProduct"
        class="px-6 py-3 bg-red-600 hover:bg-red-700 text-white font-medium rounded-lg disabled:opacity-50 disabled:cursor-not-allowed">
        ðŸ’¾ Record Damage
      </button>
      <button 
        (click)="resetForm()"
        class="px-6 py-3 bg-gray-300 hover:bg-gray-400 text-gray-800 font-medium rounded-lg">
        Clear
      </button>
    </div>
  </div>

  <!-- Damage Records Table -->
  <div class="bg-white dark:bg-white-100 shadow-md sm:rounded-lg overflow-hidden">
    <div class="flex items-center justify-between p-4 bg-yellow-50">
      <h3 class="text-lg font-semibold text-gray-900 dark:text-gray-600">Damage History</h3>
      <div class="text-sm font-medium text-gray-700">
        Total Loss: <span class="text-red-600 text-xl font-bold">Rs. {{ getTotalLoss() | number }}</span>
      </div>
    </div>

    <div class="overflow-x-auto">
      <table class="w-full text-sm text-left text-dark dark:text-dark-400">
        <thead class="text-xs text-gray-700 uppercase bg-gray-50 dark:bg-yellow-100 dark:text-gray-400">
          <tr>
            <th class="px-4 py-3">Date</th>
            <th class="px-4 py-3">Product</th>
            <th class="px-4 py-3">Damage Type</th>
            <th class="px-4 py-3">Qty</th>
            <th class="px-4 py-3">Buy Price</th>
            <th class="px-4 py-3">Loss Amount</th>
            <th class="px-4 py-3">Description</th>
          </tr>
        </thead>
        <tbody class="divide-y dark:divide-gray-700">
          <tr *ngFor="let r of pagedRecords()" class="hover:bg-gray-50">
            <td class="px-4 py-3">{{ r.damageDate | date:'short' }}</td>
            <td class="px-4 py-3">
              <div class="font-medium">{{ r.brand }} {{ r.model }}</div>
              <div class="text-xs text-gray-500">{{ r.category }}</div>
            </td>
            <td class="px-4 py-3">
              <span class="px-2 py-1 text-xs font-medium rounded-full"
                    [class.bg-red-100]="r.damageType === 'Broken Screen'"
                    [class.text-red-800]="r.damageType === 'Broken Screen'"
                    [class.bg-blue-100]="r.damageType === 'Water Damage'"
                    [class.text-blue-800]="r.damageType === 'Water Damage'"
                    [class.bg-yellow-100]="r.damageType === 'Defective'"
                    [class.text-yellow-800]="r.damageType === 'Defective'">
                {{ r.damageType }}
              </span>
            </td>
            <td class="px-4 py-3">{{ r.quantity }}</td>
            <td class="px-4 py-3">Rs. {{ r.buyPrice | number }}</td>
            <td class="px-4 py-3 font-bold text-red-600">Rs. {{ r.lossAmount | number }}</td>
            <td class="px-4 py-3 text-xs text-gray-600">{{ r.damageReason || 'N/A' }}</td>
          </tr>
        </tbody>
      </table>
    </div>

    <!-- Pagination -->
    <nav class="flex flex-col md:flex-row justify-between items-start md:items-center space-y-3 md:space-y-0 p-4">
      <span class="text-sm font-normal text-dark-500">
        Page {{ page }} / {{ totalPages() }}
      </span>
      <div class="inline-flex items-stretch -space-x-px">
        <button (click)="prevPage()" [disabled]="page === 1"
                class="px-4 py-2 text-sm text-gray-500 bg-white rounded-l-lg border border-gray-300 hover:bg-gray-100 disabled:opacity-50 disabled:cursor-not-allowed">
          Prev
        </button>
        <button (click)="nextPage()" [disabled]="page === totalPages()"
                class="px-4 py-2 text-sm text-gray-500 bg-white rounded-r-lg border border-gray-300 hover:bg-gray-100 disabled:opacity-50 disabled:cursor-not-allowed">
          Next
        </button>
      </div>
    </nav>
  </div>
</section>
