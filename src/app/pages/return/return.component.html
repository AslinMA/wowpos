<section class="bg-white dark:bg-white-100 shadow-md sm:rounded-lg p-4 sm:p-6 mx-2 sm:mx-auto max-w-7xl mt-20">

  <!-- Header -->
  <div class="flex items-center justify-between mb-6 border-b border-gray-200 pb-3">
    <h1 class="text-3xl font-medium text-gray-900 dark:text-gray-600">üîÑ Return & Exchange</h1>
  </div>

  <!-- Search Transaction -->
  <div class="bg-white dark:bg-white-100 shadow-sm sm:rounded-lg p-6 mb-6">
    <h2 class="text-xl font-semibold text-gray-900 dark:text-gray-600 mb-4">Search Sale Transaction</h2>

    <div class="flex gap-3">
      <input type="text" [(ngModel)]="searchTransactionId"
        placeholder="Enter Phone Number, Customer Name, or Transaction ID"
        class="flex-1 px-4 py-3 border border-gray-300 rounded-lg focus:ring-yellow-500 focus:border-yellow-500 dark:bg-gray-50 dark:border-gray-400">

      <button (click)="searchSale()"
        class="px-6 py-3 bg-yellow-500 hover:bg-yellow-600 text-white font-medium rounded-lg">
        üîç Search
      </button>
    </div>
  </div>

  <!-- Sale Details & Return Form -->
  <div *ngIf="selectedSale" class="space-y-6">

    <!-- Sale Information Card -->
    <div class="bg-blue-50 border border-blue-500 rounded-lg p-6">
      <h3 class="text-lg font-semibold text-gray-900 mb-4">üìã Original Sale Information</h3>

      <div class="grid grid-cols-1 md:grid-cols-3 gap-4 mb-4">
        <div>
          <div class="text-sm text-gray-600">Transaction ID</div>
          <div class="font-semibold">{{ selectedSale.transactionId }}</div>
        </div>
        <div>
          <div class="text-sm text-gray-600">Sale Date</div>
          <div class="font-semibold">{{ selectedSale.saleDate | date:'medium' }}</div>
        </div>
        <div>
          <div class="text-sm text-gray-600">Warranty Period</div>
          <div class="font-semibold">{{ selectedSale.warrantyPeriod }}</div>
        </div>
      </div>

      <div class="grid grid-cols-1 md:grid-cols-2 gap-4 mb-4">
        <div>
          <div class="text-sm text-gray-600">Customer Name</div>
          <div class="font-semibold">{{ selectedSale.customerName }}</div>
        </div>
        <div>
          <div class="text-sm text-gray-600">Customer Phone</div>
          <div class="font-semibold">{{ selectedSale.customerPhone }}</div>
        </div>
      </div>

      <div class="border-t border-blue-300 pt-4 mt-4">
        <div class="text-sm text-gray-600 mb-2">Product Details</div>
        <div class="bg-white rounded-lg p-4">
          <div class="flex justify-between items-center">
            <div>
              <div class="font-bold text-lg">{{ selectedSale.brand }} {{ selectedSale.model }}</div>
              <div class="text-sm text-gray-600">Category: {{ selectedSale.category }}</div>
              <div class="text-sm text-gray-600">Quantity: {{ selectedSale.quantity }}</div>
            </div>
            <div class="text-right">
              <div class="text-sm text-gray-600">Sell Price</div>
              <div class="font-bold text-xl text-green-600">Rs. {{ selectedSale.sellPrice | number }}</div>
            </div>
          </div>
        </div>
      </div>

      <!-- Warranty Status -->
      <div *ngIf="warrantyStatus" class="mt-4 p-4 rounded-lg" [class.bg-green-100]="warrantyStatus.valid"
        [class.border-green-500]="warrantyStatus.valid" [class.bg-red-100]="!warrantyStatus.valid"
        [class.border-red-500]="!warrantyStatus.valid" class="border-2">
        <div class="flex items-center justify-between">
          <div>
            <div class="font-bold text-lg">Warranty Status</div>
            <div class="text-sm">{{ warrantyStatus.message }}</div>
          </div>
          <div class="text-3xl">
            {{ warrantyStatus.valid ? '‚úÖ' : '‚ùå' }}
          </div>
        </div>
      </div>
    </div>

    <!-- Replacement Selection -->
    <div class="bg-white dark:bg-white-100 shadow-sm sm:rounded-lg p-6">
      <h3 class="text-xl font-semibold text-gray-900 dark:text-gray-600 mb-4">üîÑ Select Replacement Product</h3>

      <div *ngIf="filteredProducts.length > 0" class="space-y-3">
        <div class="text-sm text-gray-600 mb-2">
          Available replacement items (same product):
        </div>

        <div class="grid grid-cols-1 gap-3">
          <label *ngFor="let product of filteredProducts"
            class="flex items-center p-4 border-2 rounded-lg cursor-pointer hover:bg-yellow-50"
            [class.border-yellow-500]="selectedReplacementId === product.id"
            [class.bg-yellow-50]="selectedReplacementId === product.id">
            <input type="radio" [value]="product.id" [(ngModel)]="selectedReplacementId"
              class="w-5 h-5 text-yellow-500 focus:ring-yellow-500">
            <div class="ml-4 flex-1">
              <div class="font-semibold">{{ product.brand }} {{ product.model }}</div>
              <div class="text-sm text-gray-600">Category: {{ product.category }} | Available Stock: {{ product.quantity
                }}</div>
            </div>
            <div class="text-right">
              <div class="text-sm text-gray-600">Price</div>
              <div class="font-bold text-green-600">Rs. {{ product.sellPrice | number }}</div>
            </div>
          </label>
        </div>
      </div>

      <div *ngIf="filteredProducts.length === 0" class="text-center py-8 text-red-600">
        ‚ö†Ô∏è No replacement stock available for this product!
      </div>
    </div>

    <!-- Claim Type & Loss -->
    <div class="bg-white dark:bg-white-100 shadow-sm sm:rounded-lg p-6">
      <h3 class="text-xl font-semibold text-gray-900 dark:text-gray-600 mb-4">üí∞ Claim Type</h3>

      <div class="space-y-3">
        <label class="flex items-center p-4 border-2 rounded-lg cursor-pointer hover:bg-gray-50"
          [class.border-green-500]="claimType === 'Supplier Claim'"
          [class.bg-green-50]="claimType === 'Supplier Claim'">
          <input type="radio" value="Supplier Claim" [(ngModel)]="claimType"
            class="w-5 h-5 text-green-500 focus:ring-green-500">
          <div class="ml-4">
            <div class="font-semibold">Supplier Claim</div>
            <div class="text-sm text-gray-600">I will claim this return from my supplier (Rs. 0 loss)</div>
          </div>
        </label>

        <label class="flex items-center p-4 border-2 rounded-lg cursor-pointer hover:bg-gray-50"
          [class.border-red-500]="claimType === 'My Loss'" [class.bg-red-50]="claimType === 'My Loss'">
          <input type="radio" value="My Loss" [(ngModel)]="claimType" class="w-5 h-5 text-red-500 focus:ring-red-500">
          <div class="ml-4 flex-1">
            <div class="font-semibold">My Loss</div>
            <div class="text-sm text-gray-600">I will bear this cost (cannot claim from supplier)</div>
          </div>
          <div *ngIf="claimType === 'My Loss'" class="text-right">
            <div class="text-sm text-gray-600">Loss Amount</div>
            <div class="font-bold text-xl text-red-600">Rs. {{ calculateLoss() | number }}</div>
          </div>
        </label>
      </div>
    </div>

    <!-- Notes -->
    <div class="bg-white dark:bg-white-100 shadow-sm sm:rounded-lg p-6">
      <label class="block text-sm font-medium text-gray-700 dark:text-gray-500 mb-2">Additional Notes</label>
      <textarea [(ngModel)]="notes" rows="3" placeholder="Reason for return, condition of item, etc..."
        class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-yellow-500 focus:border-yellow-500 dark:bg-gray-50"></textarea>
    </div>

    <!-- Submit Buttons -->
    <div class="flex gap-3">
      <button (click)="submitReturn()" [disabled]="!selectedReplacementId"
        class="px-6 py-3 bg-yellow-500 hover:bg-yellow-600 text-white font-medium rounded-lg disabled:opacity-50 disabled:cursor-not-allowed">
        ‚úÖ Process Return & Exchange
      </button>
      <button (click)="resetForm()"
        class="px-6 py-3 bg-gray-300 hover:bg-gray-400 text-gray-800 font-medium rounded-lg">
        Clear Form
      </button>
    </div>
  </div>

  <!-- Return Records Table -->
  <div class="bg-white dark:bg-white-100 shadow-md sm:rounded-lg overflow-hidden mt-6">
    <div class="p-4 bg-yellow-50 border-b">
      <div class="flex justify-between items-center">
        <h3 class="text-lg font-semibold text-gray-900 dark:text-gray-600">Return History</h3>
        <div class="flex gap-6 text-sm">
          <div>
            <span class="text-gray-600">Supplier Claims:</span>
            <span class="font-bold text-green-600 ml-2">{{ getSupplierClaims() }}</span>
          </div>
          <div>
            <span class="text-gray-600">My Losses:</span>
            <span class="font-bold text-red-600 ml-2">{{ getMyLosses() }}</span>
          </div>
          <div>
            <span class="text-gray-600">Total Loss:</span>
            <span class="font-bold text-red-600 ml-2">Rs. {{ getTotalLoss() | number }}</span>
          </div>
        </div>
      </div>
    </div>

    <div class="overflow-x-auto">
      <table class="w-full text-sm text-left text-dark dark:text-dark-400">
        <thead class="text-xs text-gray-700 uppercase bg-gray-50 dark:bg-yellow-100 dark:text-gray-400">
          <tr>
            <th class="px-4 py-3">Return Date</th>
            <th class="px-4 py-3">Customer</th>
            <th class="px-4 py-3">Returned Item</th>
            <th class="px-4 py-3">Replacement</th>
            <th class="px-4 py-3">Warranty</th>
            <th class="px-4 py-3">Claim Type</th>
            <th class="px-4 py-3">Loss</th>
          </tr>
        </thead>
        <tbody class="divide-y dark:divide-gray-700">
          <tr *ngFor="let r of pagedRecords()" class="hover:bg-gray-50">
            <td class="px-4 py-3">{{ r.returnDate | date:'short' }}</td>
            <td class="px-4 py-3">
              <div class="font-medium">{{ r.customerName }}</div>
              <div class="text-xs text-gray-500">{{ r.customerPhone }}</div>
            </td>
            <td class="px-4 py-3">
              <div class="font-medium">{{ r.returnedBrand }} {{ r.returnedModel }}</div>
              <div class="text-xs text-gray-500">{{ r.returnedCategory }}</div>
            </td>
            <td class="px-4 py-3">
              <div class="font-medium">{{ r.replacementBrand }} {{ r.replacementModel }}</div>
              <div class="text-xs text-gray-500">{{ r.replacementCategory }}</div>
            </td>
            <td class="px-4 py-3">
              <span class="px-2 py-1 text-xs font-medium rounded-full" [class.bg-green-100]="r.withinWarranty"
                [class.text-green-800]="r.withinWarranty" [class.bg-red-100]="!r.withinWarranty"
                [class.text-red-800]="!r.withinWarranty">
                {{ r.withinWarranty ? '‚úÖ Valid' : '‚ùå Expired' }}
              </span>
            </td>
            <td class="px-4 py-3">
              <span class="px-2 py-1 text-xs font-medium rounded-full"
                [class.bg-green-100]="r.claimType === 'Supplier Claim'"
                [class.text-green-800]="r.claimType === 'Supplier Claim'" [class.bg-red-100]="r.claimType === 'My Loss'"
                [class.text-red-800]="r.claimType === 'My Loss'">
                {{ r.claimType }}
              </span>
            </td>
            <td class="px-4 py-3">
              <span class="font-bold" [class.text-red-600]="r.lossAmount > 0">
                Rs. {{ r.lossAmount | number }}
              </span>
            </td>
          </tr>
        </tbody>
      </table>
    </div>

    <!-- Pagination -->
    <nav class="flex flex-col md:flex-row justify-between items-start md:items-center space-y-3 md:space-y-0 p-4">
      <span class="text-sm font-normal text-dark-500">
        Page {{ page }} / {{ totalPages() }}
      </span>
      <div class="inline-flex items-stretch -space-x-px">
        <button (click)="prevPage()" [disabled]="page === 1"
          class="px-4 py-2 text-sm text-gray-500 bg-white rounded-l-lg border border-gray-300 hover:bg-gray-100 disabled:opacity-50 disabled:cursor-not-allowed">
          Prev
        </button>
        <button (click)="nextPage()" [disabled]="page === totalPages()"
          class="px-4 py-2 text-sm text-gray-500 bg-white rounded-r-lg border border-gray-300 hover:bg-gray-100 disabled:opacity-50 disabled:cursor-not-allowed">
          Next
        </button>
      </div>
    </nav>
  </div>
</section>